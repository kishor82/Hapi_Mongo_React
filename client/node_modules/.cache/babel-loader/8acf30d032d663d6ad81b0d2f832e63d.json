{"ast":null,"code":"import _regeneratorRuntime from\"/home/ad.rapidops.com/kishor.rathva/Worspace/hapi-mongo-ts/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ad.rapidops.com/kishor.rathva/Worspace/hapi-mongo-ts/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/ad.rapidops.com/kishor.rathva/Worspace/hapi-mongo-ts/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import axios from'axios';import{PayPalButton}from'react-paypal-button-v2';import{Link,useHistory,useParams}from'react-router-dom';import{Row,Col,ListGroup,Image,Card,Button}from'react-bootstrap';import{useSelector,useDispatch}from'react-redux';import Message from'../components/Message';import Loader from'../components/Loader';import{getOrderDetails,payOrder,deliverOrder}from'../actions/orderActions';import{ORDER_PAY_RESET,ORDER_DELIVER_RESET}from'../constants/orderConstants';var addDecimals=function addDecimals(num){return(Math.round(num*100)/100).toFixed(2);};var OrderScreen=function OrderScreen(){var _order$shippingAddres,_order$shippingAddres2,_order$shippingAddres3,_order$shippingAddres4;var history=useHistory();var _useParams=useParams(),orderId=_useParams.id;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),clientId=_useState2[0],setClientId=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),sdkReady=_useState4[0],setSdkReacy=_useState4[1];var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.orderDetails;}),order=_useSelector.order,loading=_useSelector.loading,error=_useSelector.error;var _useSelector2=useSelector(function(state){return state.orderPay;}),loadingPay=_useSelector2.loading,successPay=_useSelector2.success;var _useSelector3=useSelector(function(state){return state.orderDeliver;}),loadingDeliver=_useSelector3.loading,successDeliver=_useSelector3.success;var _useSelector4=useSelector(function(state){return state.userLogin;}),userInfo=_useSelector4.userInfo;if(!loading&&order){order.itemsPrice=addDecimals(order.orderItems.reduce(function(acc,item){return acc+item.price*item.qty;},0));}useEffect(function(){/**\n     * get order initially on every render'\n     */dispatch(getOrderDetails(orderId));// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){if(!userInfo){history.push('/login');}var getClientId=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/v1/config/paypal');case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;setClientId(clientId);case 5:case\"end\":return _context.stop();}}},_callee);}));return function getClientId(){return _ref.apply(this,arguments);};}();if(!order||successPay||successDeliver){dispatch(getOrderDetails(orderId));dispatch({type:ORDER_PAY_RESET});dispatch({type:ORDER_DELIVER_RESET});}getClientId();},[orderId,dispatch,successPay,successDeliver,order,history,userInfo]);var successPaymentHandler=function successPaymentHandler(paymentResult){dispatch(payOrder(orderId,paymentResult));};var deliverHandler=function deliverHandler(){dispatch(deliverOrder(orderId));};return loading?/*#__PURE__*/React.createElement(Loader,null):error?/*#__PURE__*/React.createElement(Message,{variant:\"danger\"},error):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"h1\",null,\"Order \",order._id),/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{md:8},/*#__PURE__*/React.createElement(ListGroup,{variant:\"flush\"},/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Shipping\"),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Name: \"),\" \",order.user.name),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Email: \"),\" \",/*#__PURE__*/React.createElement(\"a\",{href:\"mailto:\".concat(order.user.email)},order.user.email)),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Address:\"),(_order$shippingAddres=order.shippingAddress)===null||_order$shippingAddres===void 0?void 0:_order$shippingAddres.address,\",\",(_order$shippingAddres2=order.shippingAddress)===null||_order$shippingAddres2===void 0?void 0:_order$shippingAddres2.city,\" \",(_order$shippingAddres3=order.shippingAddress)===null||_order$shippingAddres3===void 0?void 0:_order$shippingAddres3.postalCode,\",\",' ',(_order$shippingAddres4=order.shippingAddress)===null||_order$shippingAddres4===void 0?void 0:_order$shippingAddres4.country),order.isDelivered?/*#__PURE__*/React.createElement(Message,{variant:\"success\"},\"Deliverd on \",order.deliveredAt):/*#__PURE__*/React.createElement(Message,{variant:\"danger\"},\"Not Deliverd\")),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Payment Method\"),/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Method:\"),order.paymentMethod),order.isPaid?/*#__PURE__*/React.createElement(Message,{variant:\"success\"},\"Paid on \",order.paidAt):/*#__PURE__*/React.createElement(Message,{variant:\"danger\"},\"Not Paid\")),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Order Items\"),/*#__PURE__*/React.createElement(\"strong\",null,\"Method:\"),!order.orderItems.length?/*#__PURE__*/React.createElement(Message,null,\"Order is empty\"):/*#__PURE__*/React.createElement(ListGroup,{variant:\"flush\"},order.orderItems.map(function(item,index){return/*#__PURE__*/React.createElement(ListGroup.Item,{key:index},/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{md:1},/*#__PURE__*/React.createElement(Image,{src:item.image,alt:item.name,fluid:true,rounded:true})),/*#__PURE__*/React.createElement(Col,null,/*#__PURE__*/React.createElement(Link,{to:\"/product/\".concat(item.product)},item.name)),/*#__PURE__*/React.createElement(Col,{md:4},item.qty,\" x $\",item.price,\" = $\",item.qty*item.price)));}))))),/*#__PURE__*/React.createElement(Col,{md:4},/*#__PURE__*/React.createElement(Card,null,/*#__PURE__*/React.createElement(ListGroup,{variant:\"flush\"},/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(\"h2\",null,\"Order Summary\")),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,\"Items\"),/*#__PURE__*/React.createElement(Col,null,\"$\",order.itemsPrice))),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,\"Shipping\"),/*#__PURE__*/React.createElement(Col,null,\"$\",order.shippingPrice))),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,\"Tax\"),/*#__PURE__*/React.createElement(Col,null,\"$\",order.taxPrice))),/*#__PURE__*/React.createElement(ListGroup.Item,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,null,\"Total\"),/*#__PURE__*/React.createElement(Col,null,\"$\",order.totalPrice))),!order.isPaid&&/*#__PURE__*/React.createElement(ListGroup.Item,null,loadingPay&&/*#__PURE__*/React.createElement(Loader,null),!sdkReady&&/*#__PURE__*/React.createElement(Loader,null),!clientId?/*#__PURE__*/React.createElement(Loader,null):/*#__PURE__*/React.createElement(PayPalButton,{amount:order.totalPrice,onSuccess:successPaymentHandler,options:{clientId:clientId},onButtonReady:function onButtonReady(){return setSdkReacy(true);}})),userInfo&&userInfo.isAdmin&&order.isPaid&&!order.isDelivered&&/*#__PURE__*/React.createElement(ListGroup.Item,null,loadingDeliver&&/*#__PURE__*/React.createElement(Loader,null),/*#__PURE__*/React.createElement(Button,{type:\"button\",className:\"btn btn-block\",onClick:deliverHandler},\"Mark As Deliverd\")))))));};export default OrderScreen;","map":null,"metadata":{},"sourceType":"module"}